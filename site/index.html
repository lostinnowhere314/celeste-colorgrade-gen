<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<title>Celeste colorgrade generator</title>
	<link rel="stylesheet" href="styles.css" />
	<link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
</head>
<body style="margin: 0px;">
	<center>
	<h2>Celeste Colorgrade Generator</h2>
	
	<div id="process_items" class="step_box_container">
		<!-- Generation steps go here -->
	</div>
	
	<!-- Buttons -->
	<p>
		Add steps:
		<br>
		<button onclick="create_process_step('simple-recolor')" id='simple-recolor'>Simple recolor</button>
		<button onclick="create_process_step('8-value-recolor')" id='8-value-recolor'>8-value recolor</button>
		<br>
		<button onclick="create_process_step('recenter-colors')">Recenter colors</button>
		<button onclick="create_process_step('fill')">Fill</button>
		<button onclick="create_process_step('if-else')">Condition</button>
		<br>
		<button onclick="create_process_step('adjust-rgb')">Adjust RGB</button>
		<button onclick="create_process_step('adjust-hsv')">Adjust HSV</button>
		<br>
		<button onclick="create_process_step('brightness-contrast')">Brightness/Contrast</button>
		<button onclick="create_process_step('custom')">Custom RGB map</button>
	</p>
	
	<p>
	<button onclick = "generate()">
		Generate
	</button>
	</p>
	<p>
		<canvas id="output_image">Error: browser does not support canvas element</canvas>
		<div id="error_message"></div>
	</p>
	
	<p>To save the colorgrade, right click and select 'Save image as...' (or equivalent)</p>
	
	<!-- Put documentation/how-to below here -->
	<h3>How to use</h3>
	<div class="explanation">
	Add steps to the process, set their parameters, and then a colorgrade will be generated by sequentially applying each operation.
	
	<h4>Field types</h4>
	<strong>Colors.</strong>
	Most fields expect a color.
	The two supported formats for colors are either a hex code (e.g. "ffa037") or comma-separated decimal values (e.g. "1.0, 0.5, 0.3").
	<br>
	
	<strong>Source steps.</strong>
	This field indicates which of the previous steps to use as the input to this step.
	Index 0 is always the initial, default colorgrade.
	Negative indices are relative to the current step; the default of -1, for instance, uses the output of the previous step as input.
	<br>
	
	<strong>Expressions.</strong>
	Some fields expect an expression, which will be evaluated using Python syntax.
	Each one has the variables <tt>r, g, b</tt>, holding the values of each color channel of the input, available to use.
	This supports usual mathematical operations <tt>+, -, *, /</tt>; exponentiation using <tt>**</tt>; comparison operators <tt>&lt;, &lt;=, &gt;, &gt;=, ==</tt>; logical operators <tt>&amp;, |, ~, ^</tt>; a handful of functions (<tt>min, max, abs, clip, sin, cos, tan, sqrt, exp, log, log2, log10</tt>), and the constant <tt>pi</tt>.
	
	<h4> </h4>
	<h4> </h4>
	<h4> </h4>
	
	
	</div>
	
	<p class="site-footer">
		Created by Lost in Nowhere
		<br>
		<a href="https://github.com/lostinnowhere314/celeste-colorgrade-gen">Source code</a>
		<br>
		Powered by <a href="https://pyscript.net/">PyScript</a> and GitHub Pages
	</p>
</body>

<script>
	var canvas = document.getElementById("output_image");
	canvas.width = 256;
	canvas.height = 16;

	// Initialize the canvas
	var canvas_ctx = canvas.getContext("2d");
	canvas_ctx.fillStyle = "#000000";
	canvas_ctx.fillRect(0, 0, 256, 16);
	
	var process_items = document.getElementById("process_items");

	function placeholder() {
		alert("hi, this does not work yet, sorry");
	}
	
	// Wrapper functions; they have better error handling and work properly when created dynamically
	function create_process_step(process_type) {
		pyscript.runtime.globals.get('create_process_step')(process_type)
	}
	
	function remove_process_step(process_id) {
		pyscript.runtime.globals.get('remove_process_step')(process_id)
	}
	
	function generate() {
		pyscript.runtime.globals.get('generate')()
	}
	
	function move_up(process_id) {
		pyscript.runtime.globals.get('move_step_up')(process_id)
	}
	
	function move_down(process_id) {
		pyscript.runtime.globals.get('move_step_down')(process_id)
	}
	
</script>

<py-config>
	packages = ["numpy"]
	[[fetch]]
	from = "https://lostinnowhere314.github.io/celeste-colorgrade-gen/"
	files = ["colorgrade_gen.py", "colorgrade_core.py"]
</py-config>

<py-script>
	from colorgrade_gen import *
	
	write_colorgrade(get_default_colorgrade())
	
	create_process_step('8-value-recolor')
</py-script>


</html>